import{_ as P,D as r,E as g,F as _,G as o,V as a,M as l,S as d,H as u,Q as p,I as y,O as v,P as k,W as q,T as x,X as Q,$ as N,a0 as C}from"./index.5effc10a.js";import{Q as B}from"./QSpinnerDots.105b468b.js";import{Q as S}from"./QBadge.df07c94b.js";import{Q as F}from"./QImg.ff3d7b43.js";import{Q as w}from"./QPage.0698cd62.js";const A={name:"BuscarResultados",data(){return{productos:[],isFetched:!1,currentPage:Number(this.$route.query.page)||1,totalPages:1}},computed:{routeQ(){return this.$route.query.q||""}},mounted(){this.fetchResultados()},watch:{"$route.query.q"(){this.search=this.$route.query.q||"",this.currentPage=Number(this.$route.query.page)||1,this.fetchResultados()},"$route.query.page"(){this.currentPage=Number(this.$route.query.page)||1,this.fetchResultados()}},methods:{async fetchResultados(){var m,f;const s=(this.$route.query.q||"").trim(),i=Number(this.$route.query.page)||1;if(!s){this.productos=[],this.isFetched=!0,this.totalPages=1;return}this.loading=!0,this.isFetched=!1;try{const{data:e}=await this.$axios.get("productos",{params:{search:s,page:i}}),n=Array.isArray(e.data)?e.data:((m=e.products)==null?void 0:m.data)||[];this.totalPages=e.last_page||((f=e.products)==null?void 0:f.last_page)||1,this.productos=n.map(t=>{const c={...t};if(Number(c.porcentaje)>0){c.precioNormal=c.precio;const b=c.precio-c.precio*c.porcentaje/100;c.precio=Number(b).toFixed(2)}return c})}catch(e){console.error("Error buscando productos",e),this.productos=[],this.totalPages=1}finally{this.loading=!1,this.isFetched=!0}},cambiarPagina(s){s<1||s>this.totalPages||this.$router.push({path:"/buscar",query:{q:this.routeQ,page:s}})},clickDetalleProducto(s){this.$router.push("/detalle-producto/"+s.id+"/"+this.espacioCambioGuion(s.nombre))},espacioCambioGuion(s){return s.replace(/ |\/|\./g,"-").replace(/,/g,"")}}},h=s=>(N("data-v-2d59ceef"),s=s(),C(),s),R={class:"page-wrapper q-pa-md"},I={class:"encabezado"},j={class:"titulo"},D={key:0,class:"subtitulo"},V={key:0,class:"pagination-controls text-center q-mt-sm"},z={key:1,class:"text-center q-mt-xl"},E={key:2,class:"text-center q-mt-xl"},G=h(()=>o("div",{class:"text-h6 q-mt-md"},"No se encontraron productos",-1)),T={key:3,class:"contenedor-productos"},H={class:"products-grid"},L={key:0,class:"out-of-stock-overlay"},M=h(()=>o("span",{class:"out-of-stock-text"},"Sin Stock",-1)),O=[M],W={class:"product-name"},X={class:"product-prices"},J={key:0,class:"price-old"},K=h(()=>o("span",null,"Antes",-1)),U=h(()=>o("br",null,null,-1)),Y={class:"price-now"},Z=h(()=>o("span",null,"Ahora",-1)),$=h(()=>o("br",null,null,-1)),ee={key:0,class:"pagination-controls text-center q-mt-lg"};function te(s,i,m,f,e,n){return r(),g(w,{class:"q-pa-none"},{default:_(()=>[o("div",R,[o("div",I,[o("h1",j,"Resultados para \u201C"+a(n.routeQ)+"\u201D",1),e.isFetched?(r(),l("div",D,a(e.productos.length)+" resultado(s) \xB7 P\xE1gina "+a(e.currentPage)+" / "+a(e.totalPages),1)):d("",!0)]),e.totalPages>1?(r(),l("div",V,[u(p,{flat:"",label:"Anterior",disabled:e.currentPage===1,onClick:i[0]||(i[0]=t=>n.cambiarPagina(e.currentPage-1))},null,8,["disabled"]),o("span",null,a(e.currentPage)+" / "+a(e.totalPages),1),u(p,{flat:"",label:"Siguiente",disabled:e.currentPage===e.totalPages,onClick:i[1]||(i[1]=t=>n.cambiarPagina(e.currentPage+1))},null,8,["disabled"])])):d("",!0),s.loading?(r(),l("div",z,[u(B,{size:"50px",color:"primary"})])):e.isFetched&&e.productos.length===0?(r(),l("div",E,[u(y,{name:"sentiment_dissatisfied",size:"80px",color:"grey-5"}),G])):(r(),l("div",T,[o("div",H,[(r(!0),l(v,null,k(e.productos,t=>(r(),g(q,{key:t.id,class:"product-card-personalizada",flat:"",onClick:c=>n.clickDetalleProducto(t)},{default:_(()=>[u(F,{src:t.imagen.includes("http")?t.imagen:`${s.$url}../images/${t.imagen}`,style:{height:"160px","object-fit":"cover",position:"relative"}},{default:_(()=>[t.cantidad===0?(r(),l("div",L,O)):d("",!0),t.porcentaje?(r(),g(S,{key:1,color:"red",floating:""},{default:_(()=>[x(" -"+a(t.porcentaje)+"% ",1)]),_:2},1024)):d("",!0)]),_:2},1032,["src"]),u(Q,{class:"q-pa-sm text-center"},{default:_(()=>[o("div",W,a(t.nombre),1),o("div",X,[t.precioNormal?(r(),l("div",J,[K,U,o("strong",null,"Bs. "+a(t.precioNormal),1)])):d("",!0),o("div",Y,[Z,$,o("strong",null,"Bs. "+a(t.precio),1)])])]),_:2},1024),t.cantidad>0?(r(),g(p,{key:0,label:"A\xF1adir al carrito",icon:"shopping_cart",class:"q-mt-sm full-width cta-add",glossy:"",unelevated:"","no-caps":""})):(r(),g(p,{key:1,label:"Agotado",icon:"remove_shopping_cart",class:"q-mt-sm full-width cta-off",unelevated:"","no-caps":"",disabled:""}))]),_:2},1032,["onClick"]))),128))]),e.totalPages>1?(r(),l("div",ee,[u(p,{flat:"",label:"Anterior",disabled:e.currentPage===1,onClick:i[2]||(i[2]=t=>n.cambiarPagina(e.currentPage-1))},null,8,["disabled"]),o("span",null,a(e.currentPage)+" / "+a(e.totalPages),1),u(p,{flat:"",label:"Siguiente",disabled:e.currentPage===e.totalPages,onClick:i[3]||(i[3]=t=>n.cambiarPagina(e.currentPage+1))},null,8,["disabled"])])):d("",!0)]))])]),_:1})}var ce=P(A,[["render",te],["__scopeId","data-v-2d59ceef"]]);export{ce as default};
